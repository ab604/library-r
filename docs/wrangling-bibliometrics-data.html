<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>R for Librarians - 6&nbsp; Wrangling bibliometrics data</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./references.html" rel="next">
<link href="./data-wrangling-2.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><link href="site_libs/tabwid-1.1.3/tabwid.css" rel="stylesheet">
<script src="site_libs/tabwid-1.1.3/tabwid.js"></script>
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./wrangling-bibliometrics-data.html"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Wrangling bibliometrics data</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">R for Librarians</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/ab604/library-r" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./setting-the-scene.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Setting the scene</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./markup-languages.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Markup Languages</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./getting-started.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Getting started</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data-wrangling-1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Data wrangling I</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data-wrangling-2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Data wrangling II</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./wrangling-bibliometrics-data.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Wrangling bibliometrics data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li><a href="#sec-describing-the-problem" id="toc-sec-describing-the-problem" class="nav-link active" data-scroll-target="#sec-describing-the-problem"><span class="header-section-number">6.1</span> Describing the problem</a></li>
  <li>
<a href="#sec-downloading-the-bibliometrics-data" id="toc-sec-downloading-the-bibliometrics-data" class="nav-link" data-scroll-target="#sec-downloading-the-bibliometrics-data"><span class="header-section-number">6.2</span> Downloading the bibliometrics data</a>
  <ul class="collapse">
<li><a href="#sec-pure-data" id="toc-sec-pure-data" class="nav-link" data-scroll-target="#sec-pure-data"><span class="header-section-number">6.2.1</span> Pure data</a></li>
  <li><a href="#sec-scopus-data" id="toc-sec-scopus-data" class="nav-link" data-scroll-target="#sec-scopus-data"><span class="header-section-number">6.2.2</span> Scopus data</a></li>
  <li><a href="#sec-web-of-science-data" id="toc-sec-web-of-science-data" class="nav-link" data-scroll-target="#sec-web-of-science-data"><span class="header-section-number">6.2.3</span> Web of Science data</a></li>
  </ul>
</li>
  <li>
<a href="#sec-make-it-simple" id="toc-sec-make-it-simple" class="nav-link" data-scroll-target="#sec-make-it-simple"><span class="header-section-number">6.3</span> Make it simple</a>
  <ul class="collapse">
<li><a href="#sec-joining-the-small-table" id="toc-sec-joining-the-small-table" class="nav-link" data-scroll-target="#sec-joining-the-small-table"><span class="header-section-number">6.3.1</span> Joining the small table</a></li>
  <li><a href="#sec-separating-the-scopus-affiliations" id="toc-sec-separating-the-scopus-affiliations" class="nav-link" data-scroll-target="#sec-separating-the-scopus-affiliations"><span class="header-section-number">6.3.2</span> Separating the Scopus Affiliations</a></li>
  <li><a href="#sec-separating-the-wos-affiliations" id="toc-sec-separating-the-wos-affiliations" class="nav-link" data-scroll-target="#sec-separating-the-wos-affiliations"><span class="header-section-number">6.3.3</span> Separating the Web of Science <code>C1</code> column</a></li>
  <li><a href="#step-5-pivot-wider" id="toc-step-5-pivot-wider" class="nav-link" data-scroll-target="#step-5-pivot-wider"><span class="header-section-number">6.3.4</span> Step 5 : Pivot wider</a></li>
  </ul>
</li>
  <li>
<a href="#whole-game" id="toc-whole-game" class="nav-link" data-scroll-target="#whole-game"><span class="header-section-number">6.4</span> Whole game</a>
  <ul class="collapse">
<li><a href="#join-scopus-and-wos-tables-to-the-pure-table" id="toc-join-scopus-and-wos-tables-to-the-pure-table" class="nav-link" data-scroll-target="#join-scopus-and-wos-tables-to-the-pure-table"><span class="header-section-number">6.4.1</span> Join Scopus and Wos tables to the Pure table</a></li>
  <li><a href="#separate-the-scopus-affiliations" id="toc-separate-the-scopus-affiliations" class="nav-link" data-scroll-target="#separate-the-scopus-affiliations"><span class="header-section-number">6.4.2</span> Separate the Scopus Affiliations</a></li>
  <li><a href="#separate-the-wos-affiliations" id="toc-separate-the-wos-affiliations" class="nav-link" data-scroll-target="#separate-the-wos-affiliations"><span class="header-section-number">6.4.3</span> Separate the WoS Affiliations</a></li>
  </ul>
</li>
  </ul><div class="toc-actions"><ul><li><a href="https://github.com/ab604/library-r/edit/main/wrangling-bibliometrics-data.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/ab604/library-r/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title"><span id="sec-wrangling-bibliometrics-data" class="quarto-section-identifier"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Wrangling bibliometrics data</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header><p><strong>WORK IN PROGRESS</strong></p>
<div id="bibliometrics-summary" class="unnumbered callout callout-style-simple callout-important no-icon callout-titled" title="Summary">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Summary
</div>
</div>
<div class="callout-body-container callout-body">
<p>The bibliometrics team have a spreadsheet detailing published journal articles from which they would like to understand, <em>“Which UoS department is affiliated to each article?”</em></p>
<p>Here we go through the process of wrangling the data to answer this question and produce some summary statistics.</p>
</div>
</div>
<p>It’s time to apply our knowledge to some bibliometrics data.</p>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/sfirke/janitor">janitor</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ardata-fr.github.io/flextable-book/">flextable</a></span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="sec-describing-the-problem" class="level2" data-number="6.1"><h2 data-number="6.1" class="anchored" data-anchor-id="sec-describing-the-problem">
<span class="header-section-number">6.1</span> Describing the problem</h2>
<p>I’ll attempt to describe the problem as I understand it, and then break it down into parts that correspond with <a href="getting-started.html" class="quarto-xref"><span>Chapter 3</span></a> , <a href="data-wrangling-1.html" class="quarto-xref"><span>Chapter 4</span></a> and <a href="data-wrangling-2.html" class="quarto-xref"><span>Chapter 5</span></a>.</p>
<p>Here’s an excerpt from an email Kate sent me on 2023-11-21:</p>
<blockquote class="blockquote">
<p>[A spreadsheet] is produced from a fortnightly check… for REF and Funder Compliance… the Export Control Team periodically asks us for information about particular staff/institutions/countries and…trying to search in the Affiliations can be very time consuming…</p>
</blockquote>
<p>From what I can see, the overarching problem is this:</p>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<ol type="1">
<li>
<p>There are three data sources: Scopus, Web of Science and Pure, from which tables about publications are regularly downloaded:</p>
<p>All three tables contain DOIs for the publications, but only Scopus has the UoS department affiliations, and Pure contains the Open Access compliance information</p>
</li>
<li><p>The data contained in these three tables needs to be joined, and then joined to other data.</p></li>
<li><p>The final output is a table indicating the open access status, funding body compliance status and University department affiliation for each publication.</p></li>
</ol>
</div>
</div>
</div>
<p>Having spent a bit of time looking at the different data, I can see this is a problem that requires a mixture of several <code>dpylr</code> and <code>tidyr</code> functions. I can also see that this problem cannot be entirely automated as some of the data needed is not in the three tables.</p>
<p>To join tables we need common variables between tables: these will be the publication title and the digital object identifier (DOI), <strong>but these will have different names</strong> so we need to account for that.</p>
</section><section id="sec-downloading-the-bibliometrics-data" class="level2" data-number="6.2"><h2 data-number="6.2" class="anchored" data-anchor-id="sec-downloading-the-bibliometrics-data">
<span class="header-section-number">6.2</span> Downloading the bibliometrics data</h2>
<p>Here I have three example datasets and identify the common variables by which we might join them.</p>
<section id="sec-pure-data" class="level3" data-number="6.2.1"><h3 data-number="6.2.1" class="anchored" data-anchor-id="sec-pure-data">
<span class="header-section-number">6.2.1</span> Pure data</h3>
<p>I don’t have Admin access to <a href="https://pure.soton.ac.uk">Pure</a> so Kate had to send me some data which I saved as a <code>csv</code> file for us to use, but the process once logged into Pure is:</p>
<ul>
<li><p>Go to report definitions on the side menu, click on Managed report definitions – Add as favourite the compliance reporting link.</p></li>
<li><p>Click on [ComplianceReporting] Articles/Conferences Open Access Data for Current + Previous Year. It will open in a new window.</p></li>
<li><p>Click on XLS at the bottom of the window to create the report. The report will be generated. Click on Download XLS.</p></li>
<li><p>Click on the downloaded file and save to your folder.</p></li>
</ul>
<p>I then opened the file in Excel and saved it as a csv so that we can load the example Pure data directly from the repository of this book.</p>
<p>The table has 5,186 rows and 21 columns:</p>
<ul>
<li>The DOI is in <code>Electronic version(s) of this work &gt; DOI (Digital Object Identifier)-0</code>
</li>
<li>The publication title is <code>Title of the contribution in original language-5</code>
</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Load the Pure csv file</span></span>
<span><span class="va">pure_dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="st">"https://github.com/ab604/library-r/raw/main/data/pure-2024-03-26.csv"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Inspect the contents</span></span>
<span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">pure_dat</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 5,186
Columns: 21
$ `Electronic version(s) of this work &gt; DOI (Digital Object Identifier)-0` &lt;chr&gt; …
$ `Additional source IDs-1`                                                &lt;chr&gt; …
$ `UUID-2`                                                                 &lt;chr&gt; …
$ `ID-3`                                                                   &lt;dbl&gt; …
$ `Managing organisational unit-4`                                         &lt;chr&gt; …
$ `Title of the contribution in original language-5`                       &lt;chr&gt; …
$ `Subtitle of the contribution in original language-6`                    &lt;chr&gt; …
$ `Publication statuses and dates &gt; E-pub ahead of print-7`                &lt;chr&gt; …
$ `Publication statuses and dates &gt; Accepted/In press-8`                   &lt;chr&gt; …
$ `Workflow &gt; Step-9`                                                      &lt;chr&gt; …
$ `Electronic version(s) of this work &gt; Document version-10`               &lt;chr&gt; …
$ `Electronic version(s) of this work &gt; Licence to document-11`            &lt;chr&gt; …
$ `Managing organisational unit-12`                                        &lt;chr&gt; …
$ `Open Access status-13`                                                  &lt;chr&gt; …
$ `REF Open Access Compliance Status-14`                                   &lt;chr&gt; …
$ `REF2021 exception-15`                                                   &lt;chr&gt; …
$ `Current publication status &gt; Date-16`                                   &lt;dbl&gt; …
$ `Journal &gt; Journal-17`                                                   &lt;chr&gt; …
$ `Event-18`                                                               &lt;chr&gt; …
$ `Title of the host publication in original language-19`                  &lt;chr&gt; …
$ `Type-20`                                                                &lt;chr&gt; …</code></pre>
</div>
</div>
</section><section id="sec-scopus-data" class="level3" data-number="6.2.2"><h3 data-number="6.2.2" class="anchored" data-anchor-id="sec-scopus-data">
<span class="header-section-number">6.2.2</span> Scopus data</h3>
<p>I downloaded some data as a <code>csv</code> file from <a href="https://www.scopus.com/search/form.uri?display=advanced">Scopus Advanced Search</a> to generate a report for 31 days prior to 2024-03-13 using the following query string:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>AF-ID("University of Southampton" 60025225) AND PUBYEAR &gt; 2017 AND PUBYEAR &lt; 2025 AND ( LIMIT-TO ( DOCTYPE,"ar" ) OR LIMIT-TO ( DOCTYPE,"re" ) OR LIMIT-TO ( DOCTYPE,"cp" ) OR LIMIT-TO ( DOCTYPE,"ed" ) OR LIMIT-TO ( DOCTYPE,"le" ) ) AND RECENT(31)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>As before, I saved it so that we can load the example Scopus data directly from the repository of this book.</p>
<p>The table has 483 rows and 20 columns:</p>
<ul>
<li>The title of each publication is in the <code>Title</code> column.</li>
<li>The DOI is in the <code>DOI</code> column</li>
<li>
<code>Affiliations</code> contains the all institution departments, separated by semi-colons. Hence we have multiple values in each cell.</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Load the scopus csv file</span></span>
<span><span class="va">scopus_dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="st">"https://github.com/ab604/library-r/raw/main/data/scopus-2024-03-13.csv"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Inspect the contents</span></span>
<span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">scopus_dat</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 483
Columns: 20
$ Authors                     &lt;chr&gt; "Liu Z.; Ettabib M.A.; Bowden B.M.; Bartle…
$ `Author full names`         &lt;chr&gt; "Liu, Zhen (57220604023); Ettabib, Mohamed…
$ `Author(s) ID`              &lt;chr&gt; "57220604023; 36662229200; 57225044665; 15…
$ Title                       &lt;chr&gt; "Multiframe-based non-local means denoisin…
$ Year                        &lt;dbl&gt; 2024, 2024, 2024, 2024, 2024, 2024, 2024, …
$ `Source title`              &lt;chr&gt; "Spectrochimica Acta - Part A: Molecular a…
$ DOI                         &lt;chr&gt; "10.1016/j.saa.2024.123931", "10.1113/JP28…
$ Link                        &lt;chr&gt; "https://www.scopus.com/inward/record.uri?…
$ Affiliations                &lt;chr&gt; "Zepler Institute for Photonics and Nanoel…
$ `Authors with affiliations` &lt;chr&gt; "Liu Z., Zepler Institute for Photonics an…
$ `Funding Details`           &lt;chr&gt; "Defence Science and Technology Laboratory…
$ `Correspondence Address`    &lt;chr&gt; "Z. Liu; Zepler Institute for Photonics an…
$ Publisher                   &lt;chr&gt; "Elsevier B.V.", "John Wiley and Sons Inc"…
$ ISSN                        &lt;chr&gt; "13861425", "00223751", "00298018", "00489…
$ ISBN                        &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…
$ CODEN                       &lt;chr&gt; "SAMCA", "JPHYA", NA, "STEVA", NA, NA, "EN…
$ `Document Type`             &lt;chr&gt; "Article", "Article", "Article", "Article"…
$ `Open Access`               &lt;chr&gt; NA, "All Open Access; Hybrid Gold Open Acc…
$ Source                      &lt;chr&gt; "Scopus", "Scopus", "Scopus", "Scopus", "S…
$ EID                         &lt;chr&gt; "2-s2.0-85183956855", "2-s2.0-85186478720"…</code></pre>
</div>
</div>
</section><section id="sec-web-of-science-data" class="level3" data-number="6.2.3"><h3 data-number="6.2.3" class="anchored" data-anchor-id="sec-web-of-science-data">
<span class="header-section-number">6.2.3</span> Web of Science data</h3>
<p>I followed these steps to download Web of Science (WoS) data on 2024-03-26 as a <code>tsv</code> file.</p>
<p>On <a href="https://www.webofscience.com/wos/woscc/basic-search">Web of Science</a>:</p>
<ul>
<li><p>Under documents select AFFILIATIONS and UNIVERSITY OF SOUTHAMPTON (Note that the computer may remember the last search).</p></li>
<li><p>Click on Add date range – select Publication date down arrow and select Custom. Enter date range – last date of report drawn and current date eg. 2022-04-04 to 2022-04-25 and click search.</p></li>
<li><p>Limit the results to 2018 onwards.</p></li>
<li>
<p>Click on Document Types and select the following categories and click on Refine.</p>
<ol type="1">
<li><p>Articles</p></li>
<li><p>Early access</p></li>
<li><p>Review articles</p></li>
<li><p>Editorial materials</p></li>
<li><p>Proceeding papers</p></li>
<li><p>Letter</p></li>
</ol>
</li>
<li><p>Click EXPORT – select Tab delimited file. New window will open. Select All records. Under Record Content - select Full Record. Click Export.</p></li>
</ul>
<p>As before, I saved it so that we can load the example WoS data directly from the repository of this book.</p>
<p>It has 50 rows with 71 columns all with <a href="https://images.webofknowledge.com/images/help/WOS/hs_wos_fieldtags.html">two letter field tags</a></p>
<ul>
<li>The title of each publication is in the <code>TI</code> column.</li>
<li>The DOI is in the <code>DI</code> column</li>
<li>
<code>C1</code> is the field tag for Author address which also contains institution department information, but as with the Scopus data it contains multiple values in each cell.</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Load the Web of science tsv file</span></span>
<span><span class="va">wos_dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_tsv</a></span><span class="op">(</span><span class="st">"https://github.com/ab604/library-r/raw/main/data/web-of-science-2024-03-26.tsv"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Inspect at the contents</span></span>
<span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">wos_dat</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 50
Columns: 71
$ PT &lt;chr&gt; "J", "J", "J", "J", "J", "J", "J", "J", "J", "J", "J", "J", "J", "J…
$ AU &lt;chr&gt; "Saunders, B", "Messiou, K; de los Reyes, J; Potnis, C; Dong, P; Rw…
$ BA &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ BE &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ GP &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ AF &lt;chr&gt; "Saunders, Ben", "Messiou, Kyriaki; de los Reyes, Jay; Potnis, Chin…
$ BF &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ CA &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ TI &lt;chr&gt; "Fetuses are not adult humans: a response to Miller on abortion", "…
$ SO &lt;chr&gt; "JOURNAL OF MEDICAL ETHICS", "INTERNATIONAL JOURNAL OF INCLUSIVE ED…
$ SE &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ BS &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ LA &lt;chr&gt; "English", "English", "English", "English", "English", "English", "…
$ DT &lt;chr&gt; "Editorial Material; Early Access", "Article; Early Access", "Artic…
$ CT &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ CY &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ CL &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ SP &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ HO &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ DE &lt;chr&gt; "Abortion - Induced; Ethics; Fetus; Moral Status; Personhood", "Stu…
$ ID &lt;chr&gt; NA, "EDUCATION; POWER", "ACHIEVEMENT INEQUALITY; EDUCATIONAL-INEQUA…
$ AB &lt;chr&gt; "Miller has recently argued that fetuses have the same inherent val…
$ C1 &lt;chr&gt; "[Saunders, Ben] Univ Southampton, Polit &amp; IR, Southampton, England…
$ C3 &lt;chr&gt; "University of Southampton", "University of Southampton", "Universi…
$ RP &lt;chr&gt; "Saunders, B (corresponding author), Univ Southampton, Polit &amp; IR, …
$ EM &lt;chr&gt; "b.m.saunders@soton.ac.uk", "k.messiou@soton.ac.uk", "n.pensiero@so…
$ RI &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, "; gardes, frederic/C-1619-2013; Gow, P…
$ OI &lt;chr&gt; "Saunders, Ben/0000-0002-5147-6397", "Messiou, Kyriaki/0000-0003-34…
$ FU &lt;chr&gt; NA, "UKRI10.13039/100014013", NA, NA, NA, "Engineering and Physical…
$ FP &lt;chr&gt; NA, "UKRI10.13039/100014013", NA, NA, NA, "Engineering and Physical…
$ FX &lt;chr&gt; NA, "We would like to thank all children and teachers who took part…
$ CR &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ NR &lt;dbl&gt; 7, 50, 73, 82, 3, 60, 35, 11, 0, 47, 102, 6, 101, 2, 15, 76, 40, 61…
$ TC &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0…
$ Z9 &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0…
$ U1 &lt;dbl&gt; 0, 0, 0, 0, 1, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 1, 0, 2, 1, 2, 1, 0, 0…
$ U2 &lt;dbl&gt; 0, 0, 0, 0, 1, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 1, 0, 2, 1, 2, 1, 0, 0…
$ PU &lt;chr&gt; "BMJ PUBLISHING GROUP", "ROUTLEDGE JOURNALS, TAYLOR &amp; FRANCIS LTD",…
$ PI &lt;chr&gt; "LONDON", "ABINGDON", "ABINGDON", "LONDON", "HOBOKEN", "WASHINGTON"…
$ PA &lt;chr&gt; "BRITISH MED ASSOC HOUSE, TAVISTOCK SQUARE, LONDON WC1H 9JR, ENGLAN…
$ SN &lt;chr&gt; "0306-6800", "1360-3116", "1747-7778", "1468-215X", "0007-1315", "2…
$ EI &lt;chr&gt; "1473-4257", "1464-5173", "1747-7786", "1473-4265", "1468-4446", NA…
$ BN &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ J9 &lt;chr&gt; "J MED ETHICS", "INT J INCLUSIVE EDUC", "J SIMUL", "MED HUMANIT", "…
$ JI &lt;chr&gt; "J. Med. Ethics", "Int. J. Incl. Educ.", "J. Simul.", "Med. Humanit…
$ PD &lt;chr&gt; "2024 FEB 23", "2024 FEB 20", "2024 MAR 10", "2024 FEB 15", "2024 F…
$ PY &lt;dbl&gt; 2024, 2024, 2024, 2024, 2024, 2024, 2024, 2024, 2024, 2024, 2024, 2…
$ VL &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, 60, NA, NA, NA, 12, 6, NA, 8, NA, NA, 6…
$ IS &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, 5, NA, NA, 2, 1, NA, NA, 3, NA, NA, 3, …
$ PN &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ SU &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ SI &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ MA &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ BP &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ EP &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ AR &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, "e13138", NA, NA, "90", "010201", "1245…
$ DI &lt;chr&gt; "10.1136/jme-2024-109854", "10.1080/13603116.2024.2317729", "10.108…
$ DL &lt;chr&gt; "http://dx.doi.org/10.1136/jme-2024-109854", "http://dx.doi.org/10.…
$ D2 &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ EA &lt;chr&gt; "FEB 2024", "FEB 2024", "MAR 2024", "FEB 2024", "FEB 2024", "MAR 20…
$ PG &lt;dbl&gt; 2, 15, 15, 10, 3, 10, 25, 3, 2, 19, 52, 2, 13, 1, 4, 21, 13, 22, 10…
$ WC &lt;chr&gt; "Ethics; Medical Ethics; Social Issues; Social Sciences, Biomedical…
$ WE &lt;chr&gt; "Science Citation Index Expanded (SCI-EXPANDED); Social Science Cit…
$ SC &lt;chr&gt; "Social Sciences - Other Topics; Medical Ethics; Social Issues; Bio…
$ GA &lt;chr&gt; "JS7M6", "JA7K3", "LN5N2", "ID4Y4", "HW8F9", "KP6M7", "KP2U6", "KJ8…
$ PM &lt;dbl&gt; 38395622, NA, NA, 38360797, NA, NA, NA, NA, NA, NA, NA, NA, NA, 384…
$ OA &lt;chr&gt; NA, "hybrid", "hybrid", NA, NA, "hybrid", "hybrid, Green Submitted"…
$ HC &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ HP &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ DA &lt;date&gt; 2024-03-26, 2024-03-26, 2024-03-26, 2024-03-26, 2024-03-26, 2024-0…
$ UT &lt;chr&gt; "WOS:001175218400001", "WOS:001170495400001", "WOS:001187496600001"…</code></pre>
</div>
</div>
</section></section><section id="sec-make-it-simple" class="level2" data-number="6.3"><h2 data-number="6.3" class="anchored" data-anchor-id="sec-make-it-simple">
<span class="header-section-number">6.3</span> Make it simple</h2>
<p>To make it simple - well simpler! - lets use a single entry from each table to understand how we might tackle the whole data set.</p>
<p>Manual inspection tells me that all three tables have a publication entitled, <code>Lipid droplets in steatotic liver disease</code> with a DOI of <code>10.1097/MCO.0000000000000993</code>.</p>
<p>Using <code>filter</code> I extract the corresponding row from each table to inspect them.</p>
<div class="cell">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Pure title variable is `Title of the contribution in original language-5`</span></span>
<span><span class="va">pure_lipid</span> <span class="op">&lt;-</span> <span class="va">pure_dat</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">`Title of the contribution in original language-5`</span> <span class="op">==</span> </span>
<span>           <span class="st">"Lipid droplets in steatotic liver disease"</span><span class="op">)</span> </span>
<span><span class="co">#  Scopus title variable is Title</span></span>
<span><span class="va">scopus_lipid</span> <span class="op">&lt;-</span> <span class="va">scopus_dat</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">Title</span> <span class="op">==</span> <span class="st">"Lipid droplets in steatotic liver disease"</span><span class="op">)</span></span>
<span><span class="co"># WoS title variable is TI</span></span>
<span><span class="va">wos_lipid</span> <span class="op">&lt;-</span> <span class="va">wos_dat</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">TI</span> <span class="op">==</span> <span class="st">"Lipid droplets in steatotic liver disease"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Print number of rows and columns with dim_desc()</span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/dim_desc.html">dim_desc</a></span><span class="op">(</span><span class="va">pure_lipid</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "[1 x 21]"</code></pre>
</div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/dim_desc.html">dim_desc</a></span><span class="op">(</span><span class="va">scopus_lipid</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "[1 x 20]"</code></pre>
</div>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/dim_desc.html">dim_desc</a></span><span class="op">(</span><span class="va">wos_lipid</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "[1 x 71]"</code></pre>
</div>
</div>
<section id="sec-joining-the-small-table" class="level3" data-number="6.3.1"><h3 data-number="6.3.1" class="anchored" data-anchor-id="sec-joining-the-small-table">
<span class="header-section-number">6.3.1</span> Joining the small table</h3>
<p>We have a choice about whether to join the tables first or deal with the problem of having multiple values in the <code>Affiliation</code> and <code>C1</code> cells first?</p>
<p>Let’s do the joins first. This is an easier problem, but also as joining also filters, it reduces the number of rows and therefore when it comes to the full data, it reduces the amount of departments we need to tidy.</p>
<p>We’ll use our single row <code>pure_lipid</code> object to perform filtering joins on the full <code>scopus_dat</code> and <code>wos_dat</code> data using <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join()</a></code> as per <a href="data-wrangling-2.html#sec-filtering-join" class="quarto-xref"><span>Section 5.3</span></a>.</p>
<p>As the variables for title and DOI have different names we have to explicitly tell the join function how to map these variables using <code>by</code> and passing character vectors stating the mapping as below. I’m using two pipes and doing both joins prior to assigning a new object <code>lipid_join</code>.</p>
<p>We start with 1 row and 21 variables in <code>pure_lipid</code> and join on two variables, meaning we add 18 variables from <code>scopus_dat</code> and 69 variables from <code>wos_dat</code> to create a table with 1 row and 21 + 18 + 69 = 108 columns.</p>
<div class="cell">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">lipid_join</span> <span class="op">&lt;-</span> <span class="va">pure_lipid</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">scopus_dat</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>`Title of the contribution in original language-5` <span class="op">=</span> <span class="st">"Title"</span>,</span>
<span>                               `Electronic version(s) of this work &gt; DOI (Digital Object Identifier)-0` <span class="op">=</span> <span class="st">"DOI"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">wos_dat</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>`Title of the contribution in original language-5` <span class="op">=</span> <span class="st">"TI"</span> , </span>
<span>                           `Electronic version(s) of this work &gt; DOI (Digital Object Identifier)-0` <span class="op">=</span> <span class="st">"DI"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Print number of rows and columns with dim_desc()</span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/dim_desc.html">dim_desc</a></span><span class="op">(</span><span class="va">lipid_join</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "[1 x 108]"</code></pre>
</div>
</div>
</section><section id="sec-separating-the-scopus-affiliations" class="level3" data-number="6.3.2"><h3 data-number="6.3.2" class="anchored" data-anchor-id="sec-separating-the-scopus-affiliations">
<span class="header-section-number">6.3.2</span> Separating the Scopus Affiliations</h3>
<p>I’ll use <code>select</code> to look at <code>Affiliations</code> column in <code>lipid_join</code> that originates in the Scopus data, and we can see there are three <code>;</code> separating three values for departments: two are University of Southampton and one is from the University of Pennsylvania.</p>
<div class="cell">
<div id="lst-lipid-affiliations" class="r cell-code listing quarto-float">
<figure class="quarto-float quarto-float-lst figure"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-lipid-affiliations-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Listing&nbsp;6.1: Use <code>select</code> to see how many values are in the <code>Affiliations</code> cell
</figcaption><div aria-describedby="lst-lipid-affiliations-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode" id="lst-lipid-affiliations"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">lipid_join</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Affiliations</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/flextable.html">flextable</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/font.html">font</a></span><span class="op">(</span>part <span class="op">=</span> <span class="st">"all"</span>, fontname <span class="op">=</span> <span class="st">"Consolas"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/bg.html">bg</a></span><span class="op">(</span>bg <span class="op">=</span> <span class="st">"white"</span>, part <span class="op">=</span> <span class="st">"all"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/autofit.html">autofit</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
<div class="cell-output-display">
<div class="tabwid">
<style>.cl-a7115b02{}.cl-a705858e{font-family:'Consolas';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-a70b12ce{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-a70b2dfe{width:36.152in;background-color:rgba(255, 255, 255, 1.00);vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-a70b2e08{width:36.152in;background-color:rgba(255, 255, 255, 1.00);vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style>
<table data-quarto-disable-processing="true" class="cl-a7115b02">
<thead><tr style="overflow-wrap:break-word;"><th class="cl-a70b2dfe"><p class="cl-a70b12ce"><span class="cl-a705858e">Affiliations</span></p></th></tr></thead>
<tbody><tr style="overflow-wrap:break-word;"><td class="cl-a70b2e08"><p class="cl-a70b12ce"><span class="cl-a705858e">School of Human Development and Health, Faculty of Medicine, University of Southampton, United Kingdom; National Institute for Health Research, Southampton Biomedical Research Centre, University of Southampton, University Hospital Southampton, National Health Service Foundation Trust, Southampton, United Kingdom; Department of Genetics, Perelman School of Medicine, University of Pennsylvania, Philadelphia, PA, United States</span></p></td></tr></tbody>
</table>
</div>
</div>
</div>
<p>We can use <code><a href="https://tidyr.tidyverse.org/reference/separate_wider_delim.html">separate_wider_delim()</a></code> to split these three departments on the <code>;</code>.</p>
<p>We will provide the following arguments to the function:</p>
<ul>
<li>
<code>cols = Affiliations</code> this tells the function which column to separate into individual variables.</li>
<li>
<code>delim = ";"</code> this tells the function to split on the semi-colon. Note we supply a string.</li>
<li>
<code>names_sep = "_"</code> this automatically creates new names based on the original variable, <code>Affiliations</code> separated by <code>_</code> and numbered sequentially.</li>
<li>
<code>too_few = "align_start"</code> this we don’t need now, but when we have different numbers of departments in each row, it will number them from 1 and create <code>NA</code> cells if there are empty cells.</li>
</ul>
<p>I’m not assigning an object as I want to see how this looks.</p>
<div class="cell">
<div id="lst-lipid-separate-wider" class="r cell-code listing quarto-float">
<figure class="quarto-float quarto-float-lst figure"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-lipid-separate-wider-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Listing&nbsp;6.2: Separating the Affiliation values in <code>lipid_join</code> into individual columns using <code><a href="https://tidyr.tidyverse.org/reference/separate_wider_delim.html">separate_wider_delim()</a></code>
</figcaption><div aria-describedby="lst-lipid-separate-wider-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode" id="lst-lipid-separate-wider"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">lipid_join</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Affiliations</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate_wider_delim.html">separate_wider_delim</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="va">Affiliations</span>,</span>
<span>                       names_sep <span class="op">=</span> <span class="st">"_"</span>,</span>
<span>                       delim <span class="op">=</span> <span class="st">";"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/flextable.html">flextable</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/font.html">font</a></span><span class="op">(</span>part <span class="op">=</span> <span class="st">"all"</span>, fontname <span class="op">=</span> <span class="st">"Consolas"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/bg.html">bg</a></span><span class="op">(</span>bg <span class="op">=</span> <span class="st">"white"</span>, part <span class="op">=</span> <span class="st">"all"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/autofit.html">autofit</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
<div class="cell-output-display">
<div class="tabwid">
<style>.cl-a735aaac{}.cl-a72a9838{font-family:'Consolas';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-a72fd60e{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-a72ff008{width:8.853in;background-color:rgba(255, 255, 255, 1.00);vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-a72ff012{width:17.925in;background-color:rgba(255, 255, 255, 1.00);vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-a72ff013{width:9.777in;background-color:rgba(255, 255, 255, 1.00);vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-a72ff01c{width:8.853in;background-color:rgba(255, 255, 255, 1.00);vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-a72ff01d{width:17.925in;background-color:rgba(255, 255, 255, 1.00);vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-a72ff01e{width:9.777in;background-color:rgba(255, 255, 255, 1.00);vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style>
<table data-quarto-disable-processing="true" class="cl-a735aaac">
<thead><tr style="overflow-wrap:break-word;">
<th class="cl-a72ff008"><p class="cl-a72fd60e"><span class="cl-a72a9838">Affiliations_1</span></p></th>
<th class="cl-a72ff012"><p class="cl-a72fd60e"><span class="cl-a72a9838">Affiliations_2</span></p></th>
<th class="cl-a72ff013"><p class="cl-a72fd60e"><span class="cl-a72a9838">Affiliations_3</span></p></th>
</tr></thead>
<tbody><tr style="overflow-wrap:break-word;">
<td class="cl-a72ff01c"><p class="cl-a72fd60e"><span class="cl-a72a9838">School of Human Development and Health, Faculty of Medicine, University of Southampton, United Kingdom</span></p></td>
<td class="cl-a72ff01d"><p class="cl-a72fd60e"><span class="cl-a72a9838"> National Institute for Health Research, Southampton Biomedical Research Centre, University of Southampton, University Hospital Southampton, National Health Service Foundation Trust, Southampton, United Kingdom</span></p></td>
<td class="cl-a72ff01e"><p class="cl-a72fd60e"><span class="cl-a72a9838"> Department of Genetics, Perelman School of Medicine, University of Pennsylvania, Philadelphia, PA, United States</span></p></td>
</tr></tbody>
</table>
</div>
</div>
</div>
<p>That seems to work, so lets assign the output to a new object <code>lipid_wide</code>. We expect to add two new columns, <code>lipid_join</code> has 108 columns, we expect <code>lipid_wide</code> to have 110 columns.</p>
<div class="cell">
<div id="lst-sep-wide-lipid" class="r cell-code listing quarto-float">
<figure class="quarto-float quarto-float-lst figure"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-sep-wide-lipid-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Listing&nbsp;6.3: Separating the Affiliation values in <code>scopus_dat</code> into individual columns using <code><a href="https://tidyr.tidyverse.org/reference/separate_wider_delim.html">separate_wider_delim()</a></code> and creating a new object.
</figcaption><div aria-describedby="lst-sep-wide-lipid-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode" id="lst-sep-wide-lipid"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">lipid_wide</span> <span class="op">&lt;-</span> <span class="va">lipid_join</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate_wider_delim.html">separate_wider_delim</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="va">Affiliations</span>, </span>
<span>                       delim <span class="op">=</span> <span class="st">";"</span>, </span>
<span>                       names_sep <span class="op">=</span> <span class="st">"_"</span>, </span>
<span>                       too_few <span class="op">=</span> <span class="st">"align_start"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Print number of rows and columns with dim_desc()</span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/dim_desc.html">dim_desc</a></span><span class="op">(</span><span class="va">lipid_wide</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "[1 x 110]"</code></pre>
</div>
</div>
</section><section id="sec-separating-the-wos-affiliations" class="level3" data-number="6.3.3"><h3 data-number="6.3.3" class="anchored" data-anchor-id="sec-separating-the-wos-affiliations">
<span class="header-section-number">6.3.3</span> Separating the Web of Science <code>C1</code> column</h3>
<p>As described in <a href="#sec-web-of-science-data" class="quarto-xref"><span>Section 6.2.3</span></a>, <code>C1</code> is the field tag for Author address which also contains institution department information, but as with the Scopus data this column contains multiple values in each cell.</p>
<p>To make matters worse, the values for the departments aren’t separated using a simple delimiter.</p>
<p>Let’s look <code>C1</code> in <code>lipid_wide</code>:</p>
<div class="cell">
<div class="sourceCode" id="lst-lipid-C1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">lipid_wide</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">C1</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/flextable.html">flextable</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/autofit.html">autofit</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="tabwid">
<style>.cl-a75ce4d2{}.cl-a7525f08{font-family:'Arial';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-a7567958{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-a756917c{width:30.245in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-a7569186{width:30.245in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style>
<table data-quarto-disable-processing="true" class="cl-a75ce4d2">
<thead><tr style="overflow-wrap:break-word;"><th class="cl-a756917c"><p class="cl-a7567958"><span class="cl-a7525f08">C1</span></p></th></tr></thead>
<tbody><tr style="overflow-wrap:break-word;"><td class="cl-a7569186"><p class="cl-a7567958"><span class="cl-a7525f08">[Bilson, Josh; Scorletti, Eleonora] Univ Southampton, Fac Med, Sch Human Dev &amp; Hlth, Southampton, England; [Bilson, Josh; Scorletti, Eleonora] Univ Southampton, Natl Inst Hlth Res Southampton, Biomed Res Ctr, Southampton, England; [Bilson, Josh; Scorletti, Eleonora] Univ Hosp Southampton Natl Hlth Serv Fdn Trust, Southampton, England; [Scorletti, Eleonora] Univ Penn, Perelman Sch Med, Dept Genet, Philadelphia, PA 19104 USA</span></p></td></tr></tbody>
</table>
</div>
</div>
</div>
<p>What we’ve got are <code>;</code> between the names in the square brackets <strong>and</strong> after each country.</p>
<p>My solution here is to break the problem down into steps:</p>
<ol type="1">
<li><p>Separate as before using the <code>;</code> delimiter. This will yield columns that have names or addresses, each column name starts <code>C1_</code>.</p></li>
<li><p>Pivot the table to be longer such that the names of the new columns <code>C1_1</code>, <code>C1_2</code> etc. from step 1 become rows in default variable <code>name</code> and values populate default variable <code>value</code>.</p></li>
<li><p>Next, extract the string with the University of Southampton information from each row to a new variable called <code>department</code>. Not every row has University of Southampton information and this will create empty values.</p></li>
<li><p>Filter out all the rows with empty <code>department</code> values.</p></li>
<li><p>Pivot the table wider again creating columns with names from the <code>name</code> variable populated with values from the <code>department</code> variable.</p></li>
</ol>
<p>This should mean we have a table with just the University of Southampton affiliations from Web of Science in columns prefixed <code>C1_</code></p>
<p>Simple, huh?! It’s much more concise in code.</p>
<section id="step-1-separate-c1" class="level4" data-number="6.3.3.1"><h4 data-number="6.3.3.1" class="anchored" data-anchor-id="step-1-separate-c1">
<span class="header-section-number">6.3.3.1</span> Step 1: Separate <code>C1</code>
</h4>
<p>As before, we separate using <code><a href="https://tidyr.tidyverse.org/reference/separate_wider_delim.html">separate_wider_delim()</a></code> using <code>;</code> as the delimiter.</p>
<p>This time we end up with 7 columns as there are <code>;</code> between author names and country.</p>
<div class="cell">
<div class="sourceCode" id="lipid-wide-2" data-lst-cap="separate using `separate_wider_delim()` using `;` as the delimiter. This time we end up with 7 columns as there are `;` between author names and country."><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">lipid_wide_2</span> <span class="op">&lt;-</span> <span class="va">lipid_wide</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate_wider_delim.html">separate_wider_delim</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="va">C1</span>, </span>
<span>                       delim <span class="op">=</span> <span class="st">";"</span>, </span>
<span>                       names_sep <span class="op">=</span> <span class="st">"_"</span>, </span>
<span>                       too_few <span class="op">=</span> <span class="st">"align_start"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check the output</span></span>
<span><span class="va">lipid_wide_2</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"C1"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 1
Columns: 7
$ C1_1 &lt;chr&gt; "[Bilson, Josh"
$ C1_2 &lt;chr&gt; " Scorletti, Eleonora] Univ Southampton, Fac Med, Sch Human Dev &amp;…
$ C1_3 &lt;chr&gt; " [Bilson, Josh"
$ C1_4 &lt;chr&gt; " Scorletti, Eleonora] Univ Southampton, Natl Inst Hlth Res South…
$ C1_5 &lt;chr&gt; " [Bilson, Josh"
$ C1_6 &lt;chr&gt; " Scorletti, Eleonora] Univ Hosp Southampton Natl Hlth Serv Fdn T…
$ C1_7 &lt;chr&gt; " [Scorletti, Eleonora] Univ Penn, Perelman Sch Med, Dept Genet, …</code></pre>
</div>
</div>
</section><section id="steps-2-pivot-longer" class="level4" data-number="6.3.3.2"><h4 data-number="6.3.3.2" class="anchored" data-anchor-id="steps-2-pivot-longer">
<span class="header-section-number">6.3.3.2</span> Steps 2: Pivot longer</h4>
<p>Next we <code><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer()</a></code> and take advantage of <code><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with()</a></code> using character vector <code>"C1_"</code> as the argument to pivot on all the columns from step 1. The output is assigned to <code>lipid_wide_3</code></p>
<div class="cell">
<div class="sourceCode" id="lipid-wide-345" data-lst-cap="separate using `separate_wider_delim()` using `;` as the delimiter. This time we end up with 7 columns as there are `;` between author names and country."><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">lipid_wide_3</span> <span class="op">&lt;-</span> <span class="va">lipid_wide_2</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"C1"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="steps-3-and-4-extract-the-university-of-southampton-department-and-filter" class="level4" data-number="6.3.3.3"><h4 data-number="6.3.3.3" class="anchored" data-anchor-id="steps-3-and-4-extract-the-university-of-southampton-department-and-filter">
<span class="header-section-number">6.3.3.3</span> Steps 3 and 4 : Extract the University of Southampton department and filter</h4>
<p>Then we use <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> to create a new variable <code>department</code> based on <code><a href="https://stringr.tidyverse.org/reference/str_extract.html">str_extract()</a></code> on the <code>value</code> variable with a regex passed as a string.</p>
<p>I created the regex pattern using Generative AI giving it the string <code>[Bilson, Josh; Scorletti, Eleonora] Univ Southampton, Fac Med, Sch Human Dev &amp; Hlth, Southampton, England;</code> and a prompt:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>"write a regex to capture the text after ']' and before ', Southampton, England'"</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>I pipe this to <code>filter</code> with argument <code>!is.na()</code> that means <em>“if NOT an empty value”</em> for <code>department</code> to filter out rows with value <code>NA</code> for <code>department</code>.</p>
<p>I pipe this to <code>select</code> and use negative selection to drop the <code>value</code> column created in the pivot longer as we no longer need it.</p>
<p>The output is assigned to <code>lipid_wide_4</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">lipid_wide_4</span> <span class="op">&lt;-</span> <span class="va">lipid_wide_3</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>department <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html">str_extract</a></span><span class="op">(</span><span class="va">value</span>,<span class="st">"(?&lt;=(\\]))(.+?)(?=, Southampton, England)"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">department</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">value</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section></section><section id="step-5-pivot-wider" class="level3" data-number="6.3.4"><h3 data-number="6.3.4" class="anchored" data-anchor-id="step-5-pivot-wider">
<span class="header-section-number">6.3.4</span> Step 5 : Pivot wider</h3>
<p>Finally, we pivot wider taking the names from the <code>name</code> column and filling the columns with the values from <code>department</code>. The output is saved in <code>lipid_wide_5</code>.</p>
<p>This returns the <code>lipid_wide</code> table, but with the University of Southampton departments originally in <code>C1</code> in column now in columns prefixed <code>C1_</code></p>
<div class="cell">
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">lipid_wide_5</span> <span class="op">&lt;-</span> <span class="va">lipid_wide_4</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">name</span>, values_from <span class="op">=</span> <span class="va">department</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># </span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/dim_desc.html">dim_desc</a></span><span class="op">(</span><span class="va">lipid_wide_5</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "[1 x 112]"</code></pre>
</div>
</div>
<p>Let’s look at</p>
<div class="cell">
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">lipid_wide_5</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">6</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"C1_"</span><span class="op">)</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"Affiliations_"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/flextable.html">flextable</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/font.html">font</a></span><span class="op">(</span>part <span class="op">=</span> <span class="st">"all"</span>, fontname <span class="op">=</span> <span class="st">"Consolas"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/bg.html">bg</a></span><span class="op">(</span>bg <span class="op">=</span> <span class="st">"white"</span>, part <span class="op">=</span> <span class="st">"all"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/autofit.html">autofit</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="tabwid">
<style>.cl-a7a98a1c{}.cl-a79dcf60{font-family:'Consolas';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-a7a21aca{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-a7a23f14{width:6.165in;background-color:rgba(255, 255, 255, 1.00);vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-a7a23f1e{width:4.317in;background-color:rgba(255, 255, 255, 1.00);vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-a7a23f1f{width:5.745in;background-color:rgba(255, 255, 255, 1.00);vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-a7a23f28{width:4.233in;background-color:rgba(255, 255, 255, 1.00);vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-a7a23f29{width:8.853in;background-color:rgba(255, 255, 255, 1.00);vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-a7a23f32{width:17.925in;background-color:rgba(255, 255, 255, 1.00);vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-a7a23f3c{width:9.777in;background-color:rgba(255, 255, 255, 1.00);vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-a7a23f3d{width:6.165in;background-color:rgba(255, 255, 255, 1.00);vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-a7a23f3e{width:4.317in;background-color:rgba(255, 255, 255, 1.00);vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-a7a23f46{width:5.745in;background-color:rgba(255, 255, 255, 1.00);vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-a7a23f50{width:4.233in;background-color:rgba(255, 255, 255, 1.00);vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-a7a23f51{width:8.853in;background-color:rgba(255, 255, 255, 1.00);vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-a7a23f5a{width:17.925in;background-color:rgba(255, 255, 255, 1.00);vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-a7a23f5b{width:9.777in;background-color:rgba(255, 255, 255, 1.00);vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style>
<table data-quarto-disable-processing="true" class="cl-a7a98a1c">
<thead><tr style="overflow-wrap:break-word;">
<th class="cl-a7a23f14"><p class="cl-a7a21aca"><span class="cl-a79dcf60">Electronic version(s) of this work &gt; DOI (Digital Object Identifier)-0</span></p></th>
<th class="cl-a7a23f1e"><p class="cl-a7a21aca"><span class="cl-a79dcf60">Title of the contribution in original language-5</span></p></th>
<th class="cl-a7a23f1e"><p class="cl-a7a21aca"><span class="cl-a79dcf60">C1_2</span></p></th>
<th class="cl-a7a23f1f"><p class="cl-a7a21aca"><span class="cl-a79dcf60">C1_4</span></p></th>
<th class="cl-a7a23f28"><p class="cl-a7a21aca"><span class="cl-a79dcf60">C1_6</span></p></th>
<th class="cl-a7a23f29"><p class="cl-a7a21aca"><span class="cl-a79dcf60">Affiliations_1</span></p></th>
<th class="cl-a7a23f32"><p class="cl-a7a21aca"><span class="cl-a79dcf60">Affiliations_2</span></p></th>
<th class="cl-a7a23f3c"><p class="cl-a7a21aca"><span class="cl-a79dcf60">Affiliations_3</span></p></th>
</tr></thead>
<tbody><tr style="overflow-wrap:break-word;">
<td class="cl-a7a23f3d"><p class="cl-a7a21aca"><span class="cl-a79dcf60">10.1097/MCO.0000000000000993</span></p></td>
<td class="cl-a7a23f3e"><p class="cl-a7a21aca"><span class="cl-a79dcf60">Lipid droplets in steatotic liver disease</span></p></td>
<td class="cl-a7a23f3e"><p class="cl-a7a21aca"><span class="cl-a79dcf60"> Univ Southampton, Fac Med, Sch Human Dev &amp; Hlth</span></p></td>
<td class="cl-a7a23f46"><p class="cl-a7a21aca"><span class="cl-a79dcf60"> Univ Southampton, Natl Inst Hlth Res Southampton, Biomed Res Ctr</span></p></td>
<td class="cl-a7a23f50"><p class="cl-a7a21aca"><span class="cl-a79dcf60"> Univ Hosp Southampton Natl Hlth Serv Fdn Trust</span></p></td>
<td class="cl-a7a23f51"><p class="cl-a7a21aca"><span class="cl-a79dcf60">School of Human Development and Health, Faculty of Medicine, University of Southampton, United Kingdom</span></p></td>
<td class="cl-a7a23f5a"><p class="cl-a7a21aca"><span class="cl-a79dcf60"> National Institute for Health Research, Southampton Biomedical Research Centre, University of Southampton, University Hospital Southampton, National Health Service Foundation Trust, Southampton, United Kingdom</span></p></td>
<td class="cl-a7a23f5b"><p class="cl-a7a21aca"><span class="cl-a79dcf60"> Department of Genetics, Perelman School of Medicine, University of Pennsylvania, Philadelphia, PA, United States</span></p></td>
</tr></tbody>
</table>
</div>
</div>
</div>
</section></section><section id="whole-game" class="level2" data-number="6.4"><h2 data-number="6.4" class="anchored" data-anchor-id="whole-game">
<span class="header-section-number">6.4</span> Whole game</h2>
<p>Let’s do that again, but for the whole table and in fewer parts</p>
<section id="join-scopus-and-wos-tables-to-the-pure-table" class="level3" data-number="6.4.1"><h3 data-number="6.4.1" class="anchored" data-anchor-id="join-scopus-and-wos-tables-to-the-pure-table">
<span class="header-section-number">6.4.1</span> Join Scopus and Wos tables to the Pure table</h3>
<div class="cell">
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">pure_join</span> <span class="op">&lt;-</span> <span class="va">pure_dat</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">scopus_dat</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>`Title of the contribution in original language-5` <span class="op">=</span> <span class="st">"Title"</span>,</span>
<span>                               `Electronic version(s) of this work &gt; DOI (Digital Object Identifier)-0` <span class="op">=</span> <span class="st">"DOI"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">wos_dat</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>`Title of the contribution in original language-5` <span class="op">=</span> <span class="st">"TI"</span> , </span>
<span>                           `Electronic version(s) of this work &gt; DOI (Digital Object Identifier)-0` <span class="op">=</span> <span class="st">"DI"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Print number of rows and columns with dim_desc()</span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/dim_desc.html">dim_desc</a></span><span class="op">(</span><span class="va">pure_join</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "[5,187 x 108]"</code></pre>
</div>
</div>
</section><section id="separate-the-scopus-affiliations" class="level3" data-number="6.4.2"><h3 data-number="6.4.2" class="anchored" data-anchor-id="separate-the-scopus-affiliations">
<span class="header-section-number">6.4.2</span> Separate the Scopus Affiliations</h3>
<div class="cell">
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">pure_wide</span> <span class="op">&lt;-</span> <span class="va">pure_join</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate_wider_delim.html">separate_wider_delim</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="va">Affiliations</span>, </span>
<span>                       delim <span class="op">=</span> <span class="st">";"</span>, </span>
<span>                       names_sep <span class="op">=</span> <span class="st">"_"</span>, </span>
<span>                       too_few <span class="op">=</span> <span class="st">"align_start"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Print number of rows and columns with dim_desc()</span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/dim_desc.html">dim_desc</a></span><span class="op">(</span><span class="va">pure_wide</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "[5,187 x 185]"</code></pre>
</div>
</div>
<p>As an extra step, I’m going to use the same pivot trick to get rid of any Scopus affiliations that aren’t University of Southampton.</p>
</section><section id="separate-the-wos-affiliations" class="level3" data-number="6.4.3"><h3 data-number="6.4.3" class="anchored" data-anchor-id="separate-the-wos-affiliations">
<span class="header-section-number">6.4.3</span> Separate the WoS Affiliations</h3>
<div class="cell">
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">pure_wider</span> <span class="op">&lt;-</span> <span class="va">pure_wide</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate_wider_delim.html">separate_wider_delim</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="va">C1</span>, </span>
<span>                       delim <span class="op">=</span> <span class="st">";"</span>, </span>
<span>                       names_sep <span class="op">=</span> <span class="st">"_"</span>, </span>
<span>                       too_few <span class="op">=</span> <span class="st">"align_start"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">pure_long</span> <span class="op">&lt;-</span> <span class="va">pure_wider</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"C1_"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>department <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html">str_extract</a></span><span class="op">(</span><span class="va">value</span>,<span class="st">"(?&lt;=(\\]))(.+?)(?=, Southampton, England)"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">value</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pure_table</span> <span class="op">&lt;-</span> <span class="va">pure_long</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">name</span>, values_from <span class="op">=</span> <span class="va">department</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/dim_desc.html">dim_desc</a></span><span class="op">(</span><span class="va">pure_table</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "[5,187 x 193]"</code></pre>
</div>
</div>
<p>Deal with the missing values and keep just the rows with Southampton affiliations.</p>
<div class="cell">
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">pure_table_clean</span> <span class="op">&lt;-</span> <span class="va">pure_table</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"Affiliations_"</span><span class="op">)</span>,<span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"C1_"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>               values_to <span class="op">=</span> <span class="st">"department"</span>, </span>
<span>               values_drop_na <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>department <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_trim.html">str_trim</a></span><span class="op">(</span><span class="va">department</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Do a grouped summary using only Southampton</p>
<div class="cell">
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">pure_table_clean</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">department</span>,<span class="st">"Southampton"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>title <span class="op">=</span> <span class="va">`Title of the contribution in original language-5`</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">title</span>, <span class="va">`Open Access status-13`</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/reframe.html">reframe</a></span><span class="op">(</span><span class="va">department</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 3
   title                                       Open Access status-1…¹ department
   &lt;chr&gt;                                       &lt;chr&gt;                  &lt;chr&gt;     
 1 A machine-learning exploration of the expo… Indeterminate          School of…
 2 A machine-learning exploration of the expo… Indeterminate          NIHR Sout…
 3 A machine-learning exploration of the expo… Indeterminate          MRC Lifec…
 4 A range of replies                          Open                   Departmen…
 5 A scalable hybrid analog-digital architect… Embargoed              Institute…
 6 A track-independent vehicle indicator for … Open                   ISVR, Uni…
 7 AIDS impact special issue 2023: two-way as… Open                   CHERISH p…
 8 AIDS impact special issue 2023: two-way as… Open                   Departmen…
 9 Aligning academic career management in the… Embargoed              Southampt…
10 Alternative sources of bioactive omega-3 f… Closed                 Univ Hosp…
# ℹ abbreviated name: ¹​`Open Access status-13`</code></pre>
</div>
</div>


</section></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
          // target, if specified
          link.setAttribute("target", "_blank");
          if (link.getAttribute("rel") === null) {
            link.setAttribute("rel", "noopener");
          }
          // default icon
          link.classList.add("external");
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./data-wrangling-2.html" class="pagination-link  aria-label=" wrangling="" ii="">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Data wrangling II</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./references.html" class="pagination-link" aria-label="References">
        <span class="nav-page-text">References</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
<p>This font is <a href="https://brailleinstitute.org/freefont">Atkinson Hyperlegible</a>.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/ab604/library-r/edit/main/wrangling-bibliometrics-data.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/ab604/library-r/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
<p>This book was built with <a href="https://quarto.org/">Quarto</a>.</p>
</div>
  </div>
</footer>


</body></html>